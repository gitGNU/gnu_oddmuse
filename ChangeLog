2003-04-16  Alex Schroeder  <alex@gnu.org>

	* test-markup.pl: More Interlink tests.

	* wiki.pl (InitLinkPatterns): Changed InterLinkPattern.

	* test-markup.pl: Added page-level tests.

	* wiki.pl (GetPageLinks): No longer call StripUrlPunct.
	(StripUrlPunct): Removed.
	(SplitUrlPunct): Removed.
	(GetUrl): No longer call SplitUrlPunct, no longer return a list.
	(PrintLinkList): GetUrl no longer returns a list.
	(GetInterLink): No longer call SplitUrlPunct.
	(ApplyRules): GetUrl no longer returns a list.
	(InitLinkPatterns): Changed $UrlPattern.
	(InitRequest): Reset $Debug on every invocation (for mod_perl!).
	(InitCookie): Move password into the cookie, too, so that you can
	set the password even when you are banned and banned cannot read.
	(GetHeader): Add message at the top of the file when $Debug is set.
	(DoPassword): Get rid of the default '*' password.
	(RSS): Charsets are case-insensitive.

2003-04-15  Alex Schroeder  <alex@gnu.org>

	* wiki.pl (ApplyRules): Fixed handling of the last cell per row in
	tables.

2003-04-14  Alex Schroeder  <alex@gnu.org>

	* wiki.pl (ApplyRules): If something looked like an Interlink but
	was not, and the text contained more than one colon, backtracking
	got confused.  This bus is fixed.
	(GetInterLink): Do not reuse $id, removed bogus if condition that
	was always true.
	(GetUrl): Do not reuse $url.

2003-04-12  Alex Schroeder  <alex@gnu.org>

	* wiki.pl ($HttpCharset): Default is 'ISO-8859-1' instead of empty.
	(ApplyRules): Include and rss pseudo tags don't eat all following whitespace.
	(RSS): Error message is on a paragraph of its own.

2003-04-11  Alex Schroeder  <alex@gnu.org>

	* wiki.pl (GetRcText): Added space by Pierre Gaston <pgas@intracom.gr>.
	(GetCommonFooter): Shortcut when embedded by Pierre Gaston <pgas@intracom.gr>.

2003-04-07  Alex Schroeder  <alex@gnu.org>

	* wiki.pl (GetUrl): Unquote url, because the entire page text has
	already been quoted.

2003-04-06  Alex Schroeder  <alex@gnu.org>

	* wiki.pl (RSS): Added new div for RSS inclusion.
	(GetHtmlHeader): Added div.rss to the default stylesheet.

2003-04-01  Alex Schroeder  <alex@gnu.org>

	* wiki.pl ($RefererDir, $RefererTracking, $RefererTimeLimit)
	($RefererLimit, %Referers): New variables.
	(ApplyRules): Use GetRaw instead of IncludeRaw
	(GetRaw): Renamed from IncludeRaw and without HTML quoting.
	(BrowsePage): Use more methods from the CGI module, call
	RefererTrack if appropriate.
	(DoRc): Use more methods from the CGI module.
	(GetHtmlHeader): Added new div.
	(ForceReleaseLock): Do globbing.
	(RequestRefererLock): New function, creates locks per-page.
	(ReleaseRefererLock): New function.
	(DoUnlock): Requires globbing for refer locks.
	(GetRefererFile): New.
	(ReadReferers): New.
	(GetReferers): New.
	(UpdateReferers): New.
	(RefererTrack): New.
	(GetReferers): Quote HTML.
	(GetInterLink): If no page follows the colon, this is no interlink.
	(InitLinkPatterns): The InterLinkPattern may not contain an apostrophe (').

2003-03-28  Alex Schroeder  <alex@gnu.org>

	* wiki.pl (DoMaintain): Important bugfix!
	(InitLinkPatterns): Only set $FS and $FS0 if $FS is not set already.
	(ReadFile): Check wether $FS0 is set before doing anything.
	(DoMaintain): Ditto.
	(UrlEncode): New function.
	(GetValidatorLink): Use it.

	Tricky update!  Changing the field separator from superscript 3 to
	an ASCII control character!
	
	* wiki.pl (FS0, FS0used): New field separator for the old one, and
	a new variable to tell us if the old separator has been used.
	(InitLinkPatterns): The old separator, FS0, is set to \xb3 (the
	well-known superscript 3), and the new separator, FS, is set to
	\x1e, the ASCII control character RS, aka. RECORD SEPARATOR.
	(ReadFile): Convert data read from files from FS0 to FS if
	necessary when loading.
	(DoMaintain): More translating, some HTML changes.  Using the new
	field separator will not work for keep files, since new changes
	are just appended to the file.  The keep files must be updated,
	therefore.  This happens during maintenance, so make sure
	maintenance really gets run!  This also updates the recent changes
	log files (both old and current).
	
	(GetValidatorLink): Use $q->self_url for the validator link.

2003-03-26  Alex Schroeder  <alex@gnu.org>

	* wiki.pl (DoHistory): Removed extra <tr>.

2003-03-25  Alex Schroeder  <alex@gnu.org>

	* wiki.pl (GetHtmlHeader): New classes.
	(PrintSearchResults): Removed output variable, print as we search
	instead of only when searching is done, use CGI functions for HTML
	tags, translation.
	(PrintPageList): Use CGI functions for HTML tags.
	(DoEdit): Added new div with class preview for the preview part.

2003-03-24  Alex Schroeder  <alex@gnu.org>

	* wiki.pl (GetCommonFooter): Use CGI functions for HTML tags.
	(DoEdit): Ditto.
	(DoEdit): Ditto, plus moved preview out of the form for CSS.
	(DoPageLock): Ditto.
	(DoPageLock): Ditto.
	(DoEditBanned): Ditto, and added translations.
	(DoUpdateBanned): Ditto, and added translations.
	(DoShowVersion): Translation.
	(DoShow): Translation.

2003-03-22  Alex Schroeder  <alex@gnu.org>

	* wiki.pl (GetValidatorLink): Link to CSS Validator.
	(GetHtmlHeader): Added CSS foreground color to div tags where only
	a background was defined, and added body and a links.
	(UseSubpage): Default to 0 because GNU/Linux would always be a
	link.
	(BrowsePage): Pass $id along to OpenDefaultText.
	(OpenDefaultText): If $id is the homepage, and the revision is 0,
	attempt to display the README file instead.
	(BrowsePage): Only use cache when revision not set.
	(PrintWikiToHTML): Only save cachen when revision not set.

2003-03-21  Alex Schroeder  <alex@gnu.org>

	* wiki.pl (DataDir): Default value is the temp directory, unless
	already set.
	(ConfigFile): Don't set it, if it already has a value.
	(GetValidatorLink): New subroutine.
	(GetFooterText): Use it.
	(ValidatorLink): New option.
	(InitRequest): Use $q->script_name() instead of
	"$ENV{SCRIPT_NAME}".
	(ScriptLink): Quote HTML for actions.
	(GetMinimumFooter): Move validator link from GetFooterText to
	GetMinimumFooter.

	* wiki.pl (ScriptLink): Inherit embed and toplinkbar parameters to
	local links.
	(ISBNLink): Make URLs to shops translatable.
	(GetGotoBar): Add search button.

