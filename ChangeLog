2003-09-03  Alex Schroeder  <alex@gnu.org>

	* wiki.pl (DoEdit): Print the rule that matched when somebody is
	banned.
	(UserIsBanned): Bug fix; used $host twice.

2003-09-01  Alex Schroeder  <alex@gnu.org>

	* wiki.pl (DoMaintain): Don't change rclog files if not required.
	(PrintFooter): Print username of last author.

2003-08-29  Alex Schroeder  <alex@gnu.org>

	* wiki.pl (GetRcHtml): Link to older revisions when using the all
	parameter.
	(GetRCLink): New function.
	(PrintFooter): Add new item, using it.
	(GetRCLink): Add showedit=1.

2003-08-21  Alex Schroeder  <alex@gnu.org>

	* wiki.pl (ApplyRules): Extend journal rule to allow reverse parameter.
	(PrintJournal): New parameter to reverse journals.

2003-08-19  Alex Schroeder  <alex@gnu.org>

	* wiki.pl (GetReferers): Don't quote HTML in href to avoid having
	&amp; in the links.

2003-08-17  Alex Schroeder  <alex@gnu.org>

	* wiki.pl (ApplyRules): Fix ISBN rule.

2003-08-16  Alex Schroeder  <alex@gnu.org>

	* wiki.pl ($AllNetworkFiles): New variable.
	(GetUrl): Allow file:/// if $AllNetworkFiles is set.
	(ApplyRules): The RSS rule restores pos after calling the RSS sub.
	($UsePathInfo): New variable.
	(ScriptLink): Use it.
	(DoBrowseRequest): Use it.
	(DoBrowseRequest): Make sure to ignore path_info if $UsePathInfo
	is not set.

2003-08-15  Alex Schroeder  <alex@gnu.org>

	* wiki.pl (InitLinkPatterns): Simplify $UrlPattern and take more of
	RFC 2396 into account.
	(ApplyRules): ISBN rule now produces a dirty block.  Cleaned up
	many other rules to remove extra setting of $oldmatch.

2003-08-15  Alex Schroeder  <alex@gnu.org>

	* wiki.pl (DoBrowseRequest): Remove all the stuff up to and
	including a slash, fixing the problems reported by Roland Gruen.

2003-08-14  Alex Schroeder  <alex@gnu.org>

	* wiki.pl (InitRequest): @HtmlTags are only initialized within
	this sub in order to read the config files, first.
	(ApplyRules): New rule for empty tags such as <br />.

2003-08-02  Pierre Gaston  <pgas@intracom.gr>

	* wiki.pl (ApplyRules): Pass $block, @blocks, and @flags to
	MyRules so that dynamic rules can be written.
	(DoShowVisitors): Fix typo.
	
2003-06-30  Alex Schroeder  <alex@gnu.org>

	* wiki.pl (RcTextItem): New.
	(GetRcText): Switched to RSS 3.0.

2003-06-22  Alex Schroeder  <alex@gnu.org>

	* wiki.pl (DoHistory): Removed $canEdit.
	(GetHistoryLine): Ditto.
	(DoPassword): Removed some newlines.
	(UserCanEdit): Rewrote more compactly.  Thanks, Pierre, for suggesting it.

2003-06-21  Alex Schroeder  <alex@gnu.org>

	* wiki.pl (UrlEncode): Added more safe characters according to RFC
	2396.
	(DoBrowseRequest): Use join(' ', $q->keywords) to deal with link
	that include encoded spaces (%20) instead of underlines.
	(DoBrowseRequest): Join using '_' instead of the space character.
	(DoEdit): No longer limit the length of the summary.

2003-06-20  Alex Schroeder  <alex@gnu.org>

	* wiki.pl (PingTracker): Switched to blo.gs.
	(DoPost): Pass $id along.
	(UserCanEdit): UserIsEditor() overrides $EditAllowed=1.

	* test-markup.pl: Added another set of tests to tests
	$BracketWiki.

2003-06-18  Alex Schroeder  <alex@gnu.org>

	* wiki.pl (GetPageOrEditLink): UrlEncode all page ids.
	(GetPageLink, GetEditLink, DoRc, GetOldPageParameters): Ditto.
	(GetSearchLink, ScriptLinkDiff, GetHistoryLink): Ditto.
	(PrintFooter, PrintAllReferers): Ditto.
	(GetPermanentAnchorLink, GetPermanentAnchor): Ditto.
	(UserCanEdit): Take care of $EditAllowed==2.

2003-06-17  Alex Schroeder  <alex@gnu.org>

	* wiki.pl (InitRequest): ScriptName defaults to $q->url().
	(ScriptLink): Prefer syntax using path_info().
	(GetHtmlHeader): Removed ref. to path_info.
	(PingWeblogs): Switched to blogrolling.com.
	(DoPost): Rebrowse after pinging.
	(PingWeblogs): Use & instead of ; to separate parameters.
	(DoPingWeblogs): Pass the value of the id parameter or RCName to
	DoPingWeblogs.
	($NotifyWeblogs): Renamed to $NotifyTracker.
	(DoPingWeblogs): Renamed to DoPingTracker.
	(PingWeblogs): Renamed to PingTracker.
	
2003-06-15  Alex Schroeder  <alex@gnu.org>

	* wiki.pl (GetRandomLink): Removed.
	(ApplyRules): Include local pages using GetPageContent, if possible.
	(GetRaw): Simplified.
	(DoPost): Append comment it necessary.
	(GetRcRss): To normal to free on page titles.
	(DoPost): Bugfix: Do not rebrowse if $comment is set.
	($NewComment): New.
	(PrintFooter): Use it.
	(OpenNewText): Check whether $CommentsPrefix is set before matching.
	(DoPost): Reorder and rewrite the comment handling code.
	(PrintJournal): Default regexp now requires the name to start with the ISO date.
	(PrintFooter): Add link to original if appropriate.
	(DoPost): Use undefined default $comment to distinguish '' $comment from no $comment.
	(DoBrowseRequest): Accept path_info as well as keywords.
	(PingWeblogs): Use path_info for the URI.

2003-06-15  Pierre Gaston  <pgas@intracom.gr>, Alex Schroeder  <alex@gnu.org>

	* wiki.pl ($CommentsPrefix): New.
	(PrintFooter): Added easy submission code.
	(OpenNewText): Only add if not commenting.
	(DoPost): Extract comments from aftertext parameter.

2003-06-13  Alex Schroeder  <alex@gnu.org>

	* wiki.pl (PrintJournal): Use the subroutine JournalSort if
	defined to sort pages.

	* test-markup.pl: Added Journal tests.

	* test-wrapper.pl: Use the new Init function.

	* test.pl ($UseConfig, $ConfigPage, $AdminPass): Set them.


	* wiki.pl ($CollectingJournal): New variable.
	(DoWikiRequest): Move all the init calls into Init.
	(Init): Moved all the init calls from DoWikiRequest here.
	(ApplyRules): Added journal rule.
	(PrintJournal): New.
	(GetGotoBar): Use GetPageLink.
	(DoPrintAllPages): Use 0 parameter when calling PrintAllPages.
	(PrintAllPages): Take extra parameter to say whether to link to
	the pages or not.
	(PrintJournal): Slice only if too large.
	(%CookieParameters): Get rid of linkrandom.
	(ScriptLinkTitle): Deleted.
	(GetAuthorLink): Include code from ScriptLinkTitle and add
	span.author.
	(GetTextArea): Parameter editwide has no effect anymore.

2003-06-12  Alex Schroeder  <alex@gnu.org>

	* wiki.pl (PingWeblogs): Use the edited page instead of the recent
	changes page for pinging weblogs.com.

2003-06-11  Alex Schroeder  <alex@gnu.org>

	* wiki.pl (InitRequest): Convert spaces to underscores for
	$HomePage, $RCName, $BannedHosts, $InterMap, $RefererFilter,
	$StyleSheetPage, and $ConfigPage.
	(InitRequest): Set @UserGotoBarPages here instead of on startup.
	(FreeToNormal): No more ucfirst.
	(InitRequest): Removed test statement.

2003-06-10  Alex Schroeder  <alex@gnu.org>

	* wiki.pl (@UserGotoBarPages): Set to $HomePage and $RcName.
	(GetGotoBar): Just use @UserGotoBarPages as-is.
	(DoEdit): Get rid of $editCols, $editRows, and the editcols and
	editrows parameters.  Call GetTextArea without 'em.
	(GetTextArea): Hardcode the rows and columns.  Don't use the style
	attribute.
	(BrowsePage): The hr before referers is not added here.
	(RefererTrack): Add the hr here.
	(GetGotoBar): Use FreeToNormal on the link.

2003-06-08  Alex Schroeder  <alex@gnu.org>

	* wiki.pl (DoWikiRequest): Cannot use $q->p($@) because of some
	bad interaction of $@ with CGI.  The resulting "<p>$ConfigFile:
	$@</p>" seems *very* brittle, so change with care.  It was also
	impossible to concat the result with the result of a call to
	ScriptLink.
	($UseSubpage): Removed.
	($MainPage): Removed; was used for subpages.
	($FreeUpper): Removed.
	(InitRequest): Removed $MainPage.
	(InitLinkPatterns): Removed $UseSubpage.
	(GetPageOrEditLink): Removed $MainPage.
	(GetPageLink): Removed $MainPage.
	(GetEditLink): Removed $MainPage.
	(BrowsePage): Removed $MainPage.
	(GetSearchLink): Removed $MainPage.
	(GetGotoBar): Removed MainPage handling.
	(ValidId): Removed $UseSubpage.
	(GenerateAllPagesList): No longer do subpages.
	(FreeToNormal): Removed $UseSubpage and $FreeUpper.
	(DoEdit): Removed $MainPage.

2003-06-05  Alex Schroeder  <alex@gnu.org>

	* wiki.pl (DoWikiRequest): $UseConfig does not control
	$ConfigPage.
	(InitLinkPatterns): Moved FS settings into new sub.
	(Init): New.
	(InitRequest): Moved it around in the file.
	(GetParam): Ditto.
	(InitCookie): Ditto.  No longer called from InitRequest but from
	DoWikiRequest directly.
	(GetHtmlHeader): Changed permanent_def to definition and
	permanent_link to link.
	(GetPermanentAnchor): Changed permanent_def to definition.
	(GetPermanentAnchorLink): Changed permanent_link to link.
	($UseConfig): Only set when undefined, so that it can be set to 0
	in the wrapper.
	($AdminPass, $EditPass): Only set when undefined.
	(InitRequest): Only set when undefined.
	(GetRc): Removed pagecount.
	(GetRcHtml): Removed pagecount and link changed name from (n
	changed) to (history).
	(GetRcText): Removed pagecount.

2003-06-04  Alex Schroeder  <alex@gnu.org>

	* wiki.pl ($ConfigPage): New.
	(@LockOnCreation): Added it.
	(DoWikiRequest): Use it, set $Message here for potential error.
	(InitRequest): Don't set $Message here.

2003-06-02  Alex Schroeder  <alex@gnu.org>

	* wiki.pl (GetHtmlHeader): Fix bug that prevented URL from
	appearing in the body class.
	(@UserGotoBarPages): New.
	(GetGotoBar): Use it.
	(%CookieParameters): Added 'linkrandom'.

2003-06-01  Alex Schroeder  <alex@gnu.org>

	* wiki.pl ($StyleSheetPage): New, default to empty.
	(@LockOnCreation): Added it.
	(%CookieParameters): Added 'theme'.
	(GetHtmlHeader): Use $StyleSheetPage if no $StyleSheet is given.
	(GetHtmlHeader): Use the 'theme' parameter, if given.

2003-05-31  Alex Schroeder  <alex@gnu.org>

	* wiki.pl (%CookieParameters): New.
	(Cookie): Use it to handle the previously inherited attributes.
	(ScriptLink): No more inheriting of parameters.
	(InheritParameter): Removed.
	(InitCookie): Password parameter handling removed.
	(GetHtmlHeader): Added CSS for permanent anchors.
	(%CookieParameters): Use pwd instead of password.

2003-05-30  Pierre Gaston  <pgas@intracom.gr>

	* wiki.pl ($PermanentAnchorsFile, $PermanentAnchors)
	(%PermanentAnchors, %PagePermanentAnchors): New.
	(ApplyRules): New rules for global anchors.
	(GetEditLink): Allow passing of class and name to the link.
	(DoBrowseRequest): New anchor action.
	(DoPost): Delete permanent anchors.
	(DeletePage): Ditto.
	(ReadPermanentAnchors): New.
	(WritePermanentAnchors): New.
	(GetPermanentAnchor): New.
	(GetPermanentAnchorLink): New.
	(DeletePermanentAnchors): New.

2003-05-29  Alex Schroeder  <alex@gnu.org>

	* wiki.pl ($RefererFilter): New.
	(@LockOnCreation): Added it.
	(UpdateReferers): Take it into account.

2003-05-28  Alex Schroeder  <alex@gnu.org>

	* wiki.pl ($InterFile): Deleted.
	($InterMap): New.
	(GetSiteUrl): Use it.
	(UserIsBanned): Fixed regexp.
	(GetSiteUrl): Use $InterSitePattern.
	(GetPageContent): New.
	(GetSiteUrl, UserCanEdit): Use it.
	(@LockOnCreation): New, defaults to ($BannedHosts, $InterMap).
	(DoPost, Save): Use it.

2003-05-27  Alex Schroeder  <alex@gnu.org>

	* wiki.pl ($HttpCharset): Default to UTF-8.

2003-05-26  Alex Schroeder  <alex@gnu.org>

	* wiki.pl ($BanListFile): No more banned file.
	($BannedHosts): New variable for the page name.
	(DoBrowseRequest): No more editbanned action and edit_ban parameter.
	(UserIsBanned): Test now opens the $BannedHosts page.
	(DoPost): Added test such that only admins can create the $BannedHosts file.
	(Save): When saving the first revision of the $BannedHosts file, lock it.
	(DoEditBanned): Deleted.
	(DoUpdateBanned): Deleted.

	(ScriptLink): No more quoting of the action, this happens
	automatically.

2003-05-24  Alex Schroeder  <alex@gnu.org>

	* wiki.pl (PrintAllReferers): New function.
	(DoPrintAllReferers): New function.
	(DoBrowseRequest): New refer action.
	(GetReferers): Fixed spelling of Referer to Referrer.

	Lots of tiny changes -- moved from the &foo() notation to foo().
	Saved some lines by changing some if conditions around.
	This patch is very big!

	Unified all lock requests and releases:
	(RequestDiffLock, ReleaseDiffLock, RequestVisitorsLock)
	(ReleaseVisitorsLock, RequestMergeLock, RequestMergeLock)
	(ReleaseMergeLock, ReleaseRefererLock, RequestIndexLock)
	(ReleaseIndexLock): Removed, changed callers.
	
2003-05-23  Alex Schroeder  <alex@gnu.org>

	* wiki.pl (GetRcHtml, GetRcText): Cleanup, saving some lines.

2003-05-23  Alex Schroeder  <alex@gnu.org>

	* wiki.pl ($ReplaceForm): New global variable.
	(InitRequest): Set $ReplaceForm to 0.
	(GetSearchForm): Add a replace item if $ReplaceForm is set.
	(DoSearch): Call Replace when replacement is given.
	(Replace): New function.
	(DoPost): Removed $isEdit and $editTime.  Use $Now instead.  Moved
	the saving code into Save.
	(Save): New function.

	(WriteRcLog): Use $Now instead of $editTime.
	(ReBrowsePage): Rename $isEdit to $minor.
	(GetRc, GetRcHtml, GetRcRss, GetRcText, GetRedirectPage): Ditto.
	(DoEdit, WriteRcLog, UpdateDiffs): Ditto.

2003-05-22  Alex Schroeder  <alex@gnu.org>

	* wiki.pl ($NotifyWeblogs): Add new variable, defaulting to 0.
	(DoBrowseRequest): Added new ping action.
	(DoPost): Call PingWeblogs for major edits if $NotifyWeblogs is set.
	(PingWeblogs): New.
	(DoPingWeblogs): New.

	(RFC): Include the RFCLink code.
	(RFCLink): Removed.
	(ISBN): Include the ISBNLink code.
	(ISBNLink): Removed.

2003-05-21  Alex Schroeder  <alex@gnu.org>

	* wiki.pl (InitCookie): Get hash from cookie by splitting the
	string on $FS1.
	(Cookie): Use $FS1 to encode the value.
	(PrintFooter): Call PrintMyContent with $id as the parameter.

2003-05-18  Alex Schroeder  <alex@gnu.org>

	* wiki.pl (GetHtmlHeader): Add a class to the body; the value of
	the class is the URL of the script -- this way it can be
	distinguished from all other sites in a user style sheet.

2003-05-17  Alex Schroeder  <alex@gnu.org>

	* wiki.pl ($NewText): Default value in the init section instead of
	hidden in some subroutine.
	(OpenNewText): Just use $NewText.
	(DoPost): If oldrev is 1 and the new text is $NewText, then do not
	save.
	(BrowsePage): Use a flag for PrintWikiToHTML in order to prevent
	the creation of new pages due to cache creation for the default
	text.
	(Cookie): Only set attributes if necessary.  Report setting of
	cookie via $Message.
	($SimpleLinks, $NonEnglish): Removed.
	(InitLinkPatterns): Simplified the regexp generating code such
	that the regexps used are clearer now,
	(DoUnlock): Added extra level of parenthesis, thanks to Jason
	Diamond <jason@injektilo.org>

2003-05-17  Pierre Gaston  <pgas@intracom.gr>
	
	* wiki.pl: Many subroutines: Replaced print &GetFooter(...) with
	&PrintFooter(...).
	(GetFooter, PrintFooter): Renamed GetFooter to PrintFooter, and
	changed concatenations to prints.
	
2003-05-08  Alex Schroeder  <alex@gnu.org>

	* wiki.pl (BrowsePage): Remove duplicate div class="refer".

2003-05-02  Alex Schroeder  <alex@gnu.org>

	* wiki.pl ($Debug, $Message): Renamed $Debug to $Message.
	(InitRequest): Ditto.
	(InitCookie): Ditto.
	(BrowsePage): Print header later, set $Message for the messages
	"Revision %s not available" and "Showing revision %s".
	(BrowsePage): Added new div class="rc" for recent changes output.
	(GetHeader): Changed header layout.  Logo and GotoBar are now at
	the top, followed by messages, page title, and content.  Added div
	and special days.
	(GetGotoBar): Removed special days from the goto bar.
	(GetFooterText, GetCommonFooter, GetMinimumFooter): Replaced by GetFooter.
	(GetFooter): New, unified, added div.
	(DoHistory): Use GetFooter with history parameter.
	(DoUnlock): Use GetFooter.
	(DoEdit): Use GetFooter with edit parameter.
	(DoPassword, DoEdit, UserIsEditorOrError, UserIsAdminOrError)
	(DoSearch, DoLinks, DoPrintAllPages, DoMaintain, DoMaintain)
	(DoIndex, DoConvert, DoEditLock, DoPageLock, DoEditBanned)
	(DoUpdateBanned, DoShowVersion, DoShowVisitors): Use GetFooter.
	(BrowsePage): Print div class=refer only when there are any.

2003-04-27  Alex Schroeder  <alex@gnu.org>

	* wiki.pl (BrowsePage): Added a div class="content" around the
	main part.
	(RSS): Removed unnecessary CSS class for link within RSS divs.
	(BrowsePage): Do not attempt to open keep file when the requested
	revision is the current revision.  Use div class="message" for
	the little message about the revision being displayed.
	(InheritParameter): New function.
	(GetEditLink): Use it.
	($TopLinkBar): New option.
	(GetHeader): Use it.
	($Monolithic): New variable.
	(ScriptLink): Use it.
	(DoBrowseRequest): New action 'all'.
	(DoUnlock): Rewrote using a loop.
	(GetFullLinkList): Rewrote variable declarations a bit.
	(ReleaseRefererLock, RequestRefererLock): Avoid declaring a variable for just one call.
	(DoPrintAllPages): New function.
	(PrintAllPages): New function.

2003-04-26  Alex Schroeder  <alex@gnu.org>

	* wiki.pl ($FS0used): Deleted.
	(DoBrowseRequest): Added convert action.
	(GetKeepFile): Convenience function added.
	(KeepFileName): Use it.
	(ReadFile): Removed on-the-fly separator conversion.
	(DoMaintain): Removed separator conversion of pages, no conversion
	of rc entries, no conversion of $RcOldFile.
	(DoConvert): New function.
	(ConvertFile): New functtion.
	(ReadRecentVisitors): Replaced newline and colon with field separators.
	(WriteRecentVisitors): Ditto.
	(GetReferers): Ditto.
	(DoConvert): Typo.
	(DoConvert): Typo.
	(ConvertFile): Typo.
	(DoConvert): Moved br printing.
	(ConvertFile): Moved it here.

	This undoes all the on-the-fly conversion code, since that was
	hard to maintain, and had a bug: Keep files of pages that had no
	expiry pending did not get converted.

2003-04-24  Alex Schroeder  <alex@gnu.org>

	* wiki.pl (GetRcRss): No longer treat '*' special.
	(GetRcText): No longer treat '*' special.
	(GetHistoryLine): No longer treat '*' special.
	(Cookie): No longer treat '*' special.
	(InitCookie): No longer treat '*' special.
	(GetRcHtml): No longer treat '*' special.

	* test-texi.pl: New file.
	
	* texi.pl: New file.

	* wiki.pl ($FreeUpper): Defaults to 0.

2003-04-23  Alex Schroeder  <alex@gnu.org>

	* wiki.pl (InitRequest): Set the query object charset as suggested
	by Wei Ching Tang.
	(GetHistoryLine): Do not anonymize IPs.

2003-04-18  Alex Schroeder  <alex@gnu.org>

	* wiki.pl (ApplyRules): Changed table rules.

2003-04-17  Alex Schroeder  <alex@gnu.org>

	* wiki.pl (InitLinkPatterns): Not only \xc0-\xff are non-english
	letters:  With UTF-8, \x80-\xff are.
	(InitLinkPatterns): Fixed @ in UrlPattern.
	(ApplyRules): Improved handling of space-only lines.
	(ApplyRules): Convert \r\n to \n before anything else.

2003-04-16  Alex Schroeder  <alex@gnu.org>

	* test-markup.pl: More Interlink tests.

	* wiki.pl (InitLinkPatterns): Changed InterLinkPattern.

	* test-markup.pl: Added page-level tests.

	* wiki.pl (GetPageLinks): No longer call StripUrlPunct.
	(StripUrlPunct): Removed.
	(SplitUrlPunct): Removed.
	(GetUrl): No longer call SplitUrlPunct, no longer return a list.
	(PrintLinkList): GetUrl no longer returns a list.
	(GetInterLink): No longer call SplitUrlPunct.
	(ApplyRules): GetUrl no longer returns a list.
	(InitLinkPatterns): Changed $UrlPattern.
	(InitRequest): Reset $Debug on every invocation (for mod_perl!).
	(InitCookie): Move password into the cookie, too, so that you can
	set the password even when you are banned and banned cannot read.
	(GetHeader): Add message at the top of the file when $Debug is set.
	(DoPassword): Get rid of the default '*' password.
	(RSS): Charsets are case-insensitive.

2003-04-15  Alex Schroeder  <alex@gnu.org>

	* wiki.pl (ApplyRules): Fixed handling of the last cell per row in
	tables.

2003-04-14  Alex Schroeder  <alex@gnu.org>

	* wiki.pl (ApplyRules): If something looked like an Interlink but
	was not, and the text contained more than one colon, backtracking
	got confused.  This bus is fixed.
	(GetInterLink): Do not reuse $id, removed bogus if condition that
	was always true.
	(GetUrl): Do not reuse $url.

2003-04-12  Alex Schroeder  <alex@gnu.org>

	* wiki.pl ($HttpCharset): Default is 'ISO-8859-1' instead of empty.
	(ApplyRules): Include and rss pseudo tags don't eat all following whitespace.
	(RSS): Error message is on a paragraph of its own.

2003-04-11  Alex Schroeder  <alex@gnu.org>

	* wiki.pl (GetRcText): Added space by Pierre Gaston <pgas@intracom.gr>.
	(GetCommonFooter): Shortcut when embedded by Pierre Gaston <pgas@intracom.gr>.

2003-04-07  Alex Schroeder  <alex@gnu.org>

	* wiki.pl (GetUrl): Unquote url, because the entire page text has
	already been quoted.

2003-04-06  Alex Schroeder  <alex@gnu.org>

	* wiki.pl (RSS): Added new div for RSS inclusion.
	(GetHtmlHeader): Added div.rss to the default stylesheet.

2003-04-01  Alex Schroeder  <alex@gnu.org>

	* wiki.pl ($RefererDir, $RefererTracking, $RefererTimeLimit)
	($RefererLimit, %Referers): New variables.
	(ApplyRules): Use GetRaw instead of IncludeRaw
	(GetRaw): Renamed from IncludeRaw and without HTML quoting.
	(BrowsePage): Use more methods from the CGI module, call
	RefererTrack if appropriate.
	(DoRc): Use more methods from the CGI module.
	(GetHtmlHeader): Added new div.
	(ForceReleaseLock): Do globbing.
	(RequestRefererLock): New function, creates locks per-page.
	(ReleaseRefererLock): New function.
	(DoUnlock): Requires globbing for refer locks.
	(GetRefererFile): New.
	(ReadReferers): New.
	(GetReferers): New.
	(UpdateReferers): New.
	(RefererTrack): New.
	(GetReferers): Quote HTML.
	(GetInterLink): If no page follows the colon, this is no interlink.
	(InitLinkPatterns): The InterLinkPattern may not contain an apostrophe (').

2003-03-28  Alex Schroeder  <alex@gnu.org>

	* wiki.pl (DoMaintain): Important bugfix!
	(InitLinkPatterns): Only set $FS and $FS0 if $FS is not set already.
	(ReadFile): Check wether $FS0 is set before doing anything.
	(DoMaintain): Ditto.
	(UrlEncode): New function.
	(GetValidatorLink): Use it.

	Tricky update!  Changing the field separator from superscript 3 to
	an ASCII control character!
	
	* wiki.pl (FS0, FS0used): New field separator for the old one, and
	a new variable to tell us if the old separator has been used.
	(InitLinkPatterns): The old separator, FS0, is set to \xb3 (the
	well-known superscript 3), and the new separator, FS, is set to
	\x1e, the ASCII control character RS, aka. RECORD SEPARATOR.
	(ReadFile): Convert data read from files from FS0 to FS if
	necessary when loading.
	(DoMaintain): More translating, some HTML changes.  Using the new
	field separator will not work for keep files, since new changes
	are just appended to the file.  The keep files must be updated,
	therefore.  This happens during maintenance, so make sure
	maintenance really gets run!  This also updates the recent changes
	log files (both old and current).
	
	(GetValidatorLink): Use $q->self_url for the validator link.

2003-03-26  Alex Schroeder  <alex@gnu.org>

	* wiki.pl (DoHistory): Removed extra <tr>.

2003-03-25  Alex Schroeder  <alex@gnu.org>

	* wiki.pl (GetHtmlHeader): New classes.
	(PrintSearchResults): Removed output variable, print as we search
	instead of only when searching is done, use CGI functions for HTML
	tags, translation.
	(PrintPageList): Use CGI functions for HTML tags.
	(DoEdit): Added new div with class preview for the preview part.

2003-03-24  Alex Schroeder  <alex@gnu.org>

	* wiki.pl (GetCommonFooter): Use CGI functions for HTML tags.
	(DoEdit): Ditto.
	(DoEdit): Ditto, plus moved preview out of the form for CSS.
	(DoPageLock): Ditto.
	(DoPageLock): Ditto.
	(DoEditBanned): Ditto, and added translations.
	(DoUpdateBanned): Ditto, and added translations.
	(DoShowVersion): Translation.
	(DoShow): Translation.

2003-03-22  Alex Schroeder  <alex@gnu.org>

	* wiki.pl (GetValidatorLink): Link to CSS Validator.
	(GetHtmlHeader): Added CSS foreground color to div tags where only
	a background was defined, and added body and a links.
	(UseSubpage): Default to 0 because GNU/Linux would always be a
	link.
	(BrowsePage): Pass $id along to OpenDefaultText.
	(OpenDefaultText): If $id is the homepage, and the revision is 0,
	attempt to display the README file instead.
	(BrowsePage): Only use cache when revision not set.
	(PrintWikiToHTML): Only save cachen when revision not set.

2003-03-21  Alex Schroeder  <alex@gnu.org>

	* wiki.pl (DataDir): Default value is the temp directory, unless
	already set.
	(ConfigFile): Don't set it, if it already has a value.
	(GetValidatorLink): New subroutine.
	(GetFooterText): Use it.
	(ValidatorLink): New option.
	(InitRequest): Use $q->script_name() instead of
	"$ENV{SCRIPT_NAME}".
	(ScriptLink): Quote HTML for actions.
	(GetMinimumFooter): Move validator link from GetFooterText to
	GetMinimumFooter.

	* wiki.pl (ScriptLink): Inherit embed and toplinkbar parameters to
	local links.
	(ISBNLink): Make URLs to shops translatable.
	(GetGotoBar): Add search button.

